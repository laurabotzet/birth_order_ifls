---
author: "Laura Botzet"
date: "10/26/2016"
output: html_document
---

# Preliminary Analyses

## Load libraries
```{r}
library(dplyr)
library(lme4)
library(effects)
```

## Load data
```{r}
alldata_birthorder = readRDS("data/alldata_birthorder.rds")
```

```{r}
qplot(alldata_birthorder$byear,binwidth = 1)
qplot(alldata_birthorder$age,binwidth = 1)
crosstabs(alldata_birthorder$sex.x + alldata_birthorder$sex.y)
qplot(alldata_birthorder$birthorder_uterus_alive, binwidth = 1)

alldata_birthorder = alldata_birthorder %>% 
  mutate(
    birthorder_uterus_alive_factor = as.character(birthorder_uterus_alive),
    birthorder_uterus_alive_factor = ifelse(birthorder_uterus_alive > 5, "5+", birthorder_uterus_alive_factor),
    birthorder_uterus_alive_factor = factor(birthorder_uterus_alive_factor, levels = c("1","2","3","4","5","5+")),
    sibling_count_uterus_alive_factor = as.character(sibling_count_uterus_alive),
    sibling_count_uterus_alive_factor = ifelse(sibling_count_uterus_alive > 5, "5+", sibling_count_uterus_alive_factor),
    sibling_count_uterus_alive_factor = factor(sibling_count_uterus_alive_factor, levels = c("1","2","3","4","5","5+")),
    birthorder_genes_factor = as.character(birthorder_genes),
    birthorder_genes_factor = ifelse(birthorder_genes >5 , "5+", birthorder_genes_factor),
    birthorder_genes_factor = factor(birthorder_genes_factor, levels = c("1","2","3","4","5","5+")),
    sibling_count_genes_factor = as.character(sibling_count_genes),
    sibling_count_genes_factor = ifelse(sibling_count_genes >5 , "5+", sibling_count_genes_factor),
    sibling_count_genes_factor = factor(sibling_count_genes_factor, levels = c("1","2","3","4","5","5+")))


crosstabs(~ sibling_count_uterus_alive_factor + birthorder_uterus_alive_factor, data = alldata_birthorder)
crosstabs(~ sibling_count_genes_factor + birthorder_genes_factor, data = alldata_birthorder)

alldata_birthorder$sex = factor(ifelse(alldata_birthorder$sex.x==1, "male", "female"))

# remove only children?
no_only_children_uterus = alldata_birthorder %>% filter(as.numeric(sibling_count_uterus_alive) > 1)
crosstabs(~ sibling_count_uterus_alive_factor + birthorder_uterus_alive_factor, data = no_only_children_uterus)

no_only_children_genes = alldata_birthorder %>% filter(as.numeric(sibling_count_genes) > 1)

crosstabs(~ sibling_count_genes_factor + birthorder_genes_factor, data = no_only_children_genes)

```



```{r}
m1 = lm(riskA ~ sex + age + byear + birthorder_uterus_alive, data = alldata_birthorder)
summary(m1)
m2 = lm(riskA ~ sex + age + byear + birthorder_uterus_preg, data = alldata_birthorder)
summary(m2)

x1 = lm(riskA ~ sex + age + byear + birthorder_uterus_alive_factor * sibling_count_uterus_alive_factor, data = no_only_children_uterus)
summary(x1)
plot(allEffects(x1))

x2 = lm(g_factor ~ sex + age + byear + birthorder_uterus_alive_factor * sibling_count_uterus_alive_factor, data = no_only_children_uterus)
summary(x2)
plot(allEffects(x2))

no_only_children_uterus %>%
    ggplot(aes(x=birthorder_uterus_alive_factor, y=g_factor, colour = sibling_count_uterus_alive_factor, group = sibling_count_uterus_alive_factor)) + 
  geom_pointrange(fun.data = "mean_cl_boot", stat = "summary", position = position_dodge(width = 0.4)) + 
  geom_line(fun.data = "mean_cl_boot", stat = "summary", position = position_dodge(width = 0.4))

x2_genes = lm(g_factor ~ sex + age + byear + birthorder_genes_factor * sibling_count_genes_factor, data = no_only_children_genes)
summary(x2_genes)
plot(allEffects(x2_genes))

no_only_children_genes %>%
    ggplot(aes(x=birthorder_genes_factor, y=g_factor, colour = sibling_count_genes_factor, group = sibling_count_genes_factor)) + 
  geom_pointrange(fun.data = "mean_cl_boot", stat = "summary", position = position_dodge(width = 0.4)) + 
  geom_line(fun.data = "mean_cl_boot", stat = "summary", position = position_dodge(width = 0.4))

m1m = lmer(riskA ~ gender + age + byear + birthorder_uterus_alive_factor * sibling_count_uterus_alive_factor + (1 | mother_pidlink), data = no_only_children_uterus)
summary(m1m)
```

